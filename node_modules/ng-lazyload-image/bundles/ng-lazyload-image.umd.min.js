!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ng-lazyload-image",["exports","@angular/core","@angular/common","rxjs","rxjs/operators"],t):t((e=e||self)["ng-lazyload-image"]={},e.ng.core,e.ng.common,e.rxjs,e.rxjs.operators)}(this,function(e,t,n,r,o){"use strict";function i(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function s(e,t){return function(n,r){t(n,r,e)}}function a(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var u="ng-lazyloaded",c="ng-failed-lazyloaded";function l(e,t){e.className.includes(t)||(e.className+=" "+t)}function f(){return"undefined"!=typeof window}function p(e){return Boolean(e.parentElement&&"picture"===e.parentElement.nodeName.toLowerCase())}function m(e){return"img"===e.nodeName.toLowerCase()}function g(e,t,n){return m(e)?n?e.srcset=t:e.src=t:e.style.backgroundImage="url('"+t+"')",e}function d(e){return function(t){for(var n=t.parentElement.getElementsByTagName("source"),r=0;r<n.length;r++){var o=n[r].getAttribute(e);o&&(n[r].srcset=o)}}}var h=d("defaultImage"),v=d("lazyLoad"),b=d("errorImage");function y(e){return function(t,n,r){m(t)&&p(t)&&e(t),n&&g(t,n,r)}}var I=y(h),O=y(v),w=y(b),j={finally:function(e){return l(e.element,u)},loadImage:function(e){var t,n=e.element,r=e.useSrcset,o=e.imagePath;if(m(n)&&p(n)){var i=n.parentNode.cloneNode(!0);t=i.getElementsByTagName("img")[0],v(t),g(t,o,r)}else t=new Image,m(n)&&n.sizes&&(t.sizes=n.sizes),r?t.srcset=o:t.src=o;return t.decode?t.decode().then(function(){return o}):new Promise(function(e,n){t.onload=function(){return e(o)},t.onerror=function(){return n(null)}})},setErrorImage:function(e){var t=e.element,n=e.errorImagePath,r=e.useSrcset;w(t,n,r),l(t,c)},setLoadedImage:function(e){var t=e.element,n=e.imagePath,r=e.useSrcset;O(t,n,r)},setup:function(e){var t=e.element,n=e.defaultImagePath,r=e.useSrcset;I(t,n,r),function(e,t){return e.className&&e.className.includes(t)}(t,u)&&function(e,t){e.className=e.className.replace(t,"")}(t,u)}},E=function(){function e(e,t,n,r){this.left=e,this.top=t,this.right=n,this.bottom=r}return e.fromElement=function(t){var n=t.getBoundingClientRect(),r=n.left,o=n.top,i=n.right,s=n.bottom;return 0===r&&0===o&&0===i&&0===s?e.empty:new e(r,o,i,s)},e.fromWindow=function(t){return new e(0,0,t.innerWidth,t.innerHeight)},e.prototype.inflate=function(e){this.left-=e,this.top-=e,this.right+=e,this.bottom+=e},e.prototype.intersectsWith=function(e){return e.left<this.right&&this.left<e.right&&e.top<this.bottom&&this.top<e.bottom},e.prototype.getIntersectionWith=function(t){var n=Math.max(this.left,t.left),r=Math.max(this.top,t.top),o=Math.min(this.right,t.right),i=Math.min(this.bottom,t.bottom);return o>=n&&i>=r?new e(n,r,o,i):e.empty},e.empty=new e(0,0,0,0),e}(),L=new WeakMap;var S=function(e){if(!e||"function"!=typeof e.addEventListener)return f()&&console.warn("`addEventListener` on "+e+" (scrollTarget) is not a function. Skipping this target"),r.empty();var t=L.get(e);if(t)return t;var n,i=r.Observable.create(function(t){var n=function(e){return t.next(e)},r={passive:!0,capture:!1};return e.addEventListener("scroll",n,r),function(){return e.removeEventListener("scroll",n,r)}}),s=i.pipe(o.sampleTime(100,n),o.share(),o.startWith(""));return L.set(e,s),s},C=Object.assign({},j,{isVisible:function(e,t){var n=e.element,r=e.offset,o=e.scrollContainer;void 0===t&&(t=function(){return window});var i=E.fromElement(n);if(i===E.empty)return!1;var s=E.fromWindow(t());if(i.inflate(r),o){var a=E.fromElement(o).getIntersectionWith(s);return i.intersectsWith(a)}return i.intersectsWith(s)},getObservable:function(e){return e.scrollObservable?e.scrollObservable.pipe(o.startWith("")):e.scrollContainer?S(e.scrollContainer):S(f()?window:void 0)}});var x=function(){function e(e,n,o,i){this.onLoad=new t.EventEmitter,this.elementRef=e,this.ngZone=n,this.propertyChanges$=new r.ReplaySubject,this.platformId=o,this.hooks=function(e){if(!e)return C;var t={};return e.preset?Object.assign(t,e.preset):Object.assign(t,C),Object.keys(e).filter(function(e){return"preset"!==e}).forEach(function(n){t[n]=e[n]}),t}(i)}return e.prototype.ngOnChanges=function(){this.propertyChanges$.next({element:this.elementRef.nativeElement,imagePath:this.lazyImage,defaultImagePath:this.defaultImage,errorImagePath:this.errorImage,useSrcset:this.useSrcset,offset:this.offset?0|this.offset:0,scrollContainer:this.scrollTarget,scrollObservable:this.scrollObservable})},e.prototype.ngAfterContentInit=function(){var e=this;if(n.isPlatformServer(this.platformId))return null;this.ngZone.runOutsideAngular(function(){e.scrollSubscription=e.propertyChanges$.pipe(o.tap(function(t){return e.hooks.setup(t)}),o.switchMap(function(t){return e.hooks.getObservable(t).pipe(function(e,t){return function(n){return n.pipe(o.filter(function(n){return e.isVisible({element:t.element,event:n,offset:t.offset,scrollContainer:t.scrollContainer})}),o.take(1),o.mergeMap(function(){return e.loadImage(t)}),o.tap(function(n){return e.setLoadedImage({element:t.element,imagePath:n,useSrcset:t.useSrcset})}),o.map(function(){return!0}),o.catchError(function(){return e.setErrorImage(t),r.of(!1)}),o.tap(function(){return e.finally(t)}))}}(e.hooks,t))})).subscribe(function(t){return e.onLoad.emit(t)})})},e.prototype.ngOnDestroy=function(){this.scrollSubscription&&this.scrollSubscription.unsubscribe()},i([t.Input("lazyLoad"),a("design:type",String)],e.prototype,"lazyImage",void 0),i([t.Input(),a("design:type",String)],e.prototype,"defaultImage",void 0),i([t.Input(),a("design:type",String)],e.prototype,"errorImage",void 0),i([t.Input(),a("design:type",Object)],e.prototype,"scrollTarget",void 0),i([t.Input(),a("design:type",r.Observable)],e.prototype,"scrollObservable",void 0),i([t.Input(),a("design:type",Number)],e.prototype,"offset",void 0),i([t.Input(),a("design:type",Boolean)],e.prototype,"useSrcset",void 0),i([t.Output(),a("design:type",t.EventEmitter)],e.prototype,"onLoad",void 0),e=i([t.Directive({selector:"[lazyLoad]"}),s(2,t.Inject(t.PLATFORM_ID)),s(3,t.Optional()),s(3,t.Inject("options")),a("design:paramtypes",[t.ElementRef,t.NgZone,Object,Object])],e)}(),P=function(){function e(){}var n;return n=e,e.forRoot=function(e){return{ngModule:n,providers:[{provide:"options",useValue:e}]}},e=n=i([t.NgModule({declarations:[x],exports:[x]})],e)}(),N=new WeakMap,z=new r.Subject;function M(e){e.forEach(function(e){return z.next(e)})}var R=function(e){if(!e.scrollContainer&&!f())return r.empty();var t={root:e.scrollContainer};e.offset&&(t.rootMargin=e.offset+"px");var n=e.scrollContainer||window,i=N.get(n);return i||(i=new IntersectionObserver(M,t),N.set(n,i)),i.observe(e.element),r.Observable.create(function(t){var n=z.pipe(o.filter(function(t){return t.target===e.element})).subscribe(t);return function(){n.unsubscribe(),i.unobserve(e.element)}})},W=Object.assign({},j,{isVisible:function(e){return e.event.isIntersecting},getObservable:function(e,t){return void 0===t&&(t=R),e.scrollObservable?e.scrollObservable:t(e)}});e.LazyLoadImageDirective=x,e.LazyLoadImageModule=P,e.intersectionObserverPreset=W,e.scrollPreset=C,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ng-lazyload-image.umd.min.js.map