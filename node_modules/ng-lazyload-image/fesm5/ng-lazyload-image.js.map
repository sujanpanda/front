{"version":3,"file":"ng-lazyload-image.js","sources":["ng://ng-lazyload-image/src/util/css.util.ts","ng://ng-lazyload-image/src/util/util.ts","ng://ng-lazyload-image/src/shared-preset/preset.ts","ng://ng-lazyload-image/src/scroll-preset/rect.ts","ng://ng-lazyload-image/src/scroll-preset/scroll-listener.ts","ng://ng-lazyload-image/src/scroll-preset/preset.ts","ng://ng-lazyload-image/src/hooks-factory.ts","ng://ng-lazyload-image/src/lazyload-image.ts","ng://ng-lazyload-image/src/lazyload-image.directive.ts","ng://ng-lazyload-image/src/lazyload-image.module.ts","ng://ng-lazyload-image/src/intersection-observer-preset/intersection-listener.ts","ng://ng-lazyload-image/src/intersection-observer-preset/preset.ts"],"sourcesContent":["export const cssClassNames = {\n  loaded: 'ng-lazyloaded',\n  loading: 'ng-lazyloading',\n  failed: 'ng-failed-lazyloaded'\n};\n\nexport function removeCssClassName(element: HTMLImageElement | HTMLDivElement, cssClassName: string) {\n  element.className = element.className.replace(cssClassName, '');\n}\n\nexport function addCssClassName(element: HTMLImageElement | HTMLDivElement, cssClassName: string) {\n  if (!element.className.includes(cssClassName)) {\n    element.className += ` ${cssClassName}`;\n  }\n}\n\nexport function hasCssClassName(element: HTMLImageElement | HTMLDivElement, cssClassName: string) {\n  return element.className && element.className.includes(cssClassName);\n}\n","export function isWindowDefined() {\n  return typeof window !== 'undefined';\n}\n\nexport function isChildOfPicture(element: HTMLImageElement | HTMLDivElement): boolean {\n  return Boolean(element.parentElement && element.parentElement.nodeName.toLowerCase() === 'picture');\n}\n\nexport function isImageElement(element: HTMLImageElement | HTMLDivElement): element is HTMLImageElement {\n  return element.nodeName.toLowerCase() === 'img';\n}\n\nexport function setImage(element: HTMLImageElement | HTMLDivElement, imagePath: string, useSrcset?: boolean) {\n  if (isImageElement(element)) {\n    if (useSrcset) {\n      element.srcset = imagePath;\n    } else {\n      element.src = imagePath;\n    }\n  } else {\n    element.style.backgroundImage = `url('${imagePath}')`;\n  }\n  return element;\n}\n\nfunction setSources(attrName: string) {\n  return (image: HTMLImageElement) => {\n    const sources = image.parentElement!.getElementsByTagName('source');\n    for (let i = 0; i < sources.length; i++) {\n      const attrValue = sources[i].getAttribute(attrName);\n      if (attrValue) {\n        sources[i].srcset = attrValue;\n      }\n    }\n  };\n}\n\nconst setSourcesToDefault = setSources('defaultImage');\nexport const setSourcesToLazy = setSources('lazyLoad');\nconst setSourcesToError = setSources('errorImage');\n\nfunction setImageAndSources(setSourcesFn: (image: HTMLImageElement) => void) {\n  return (element: HTMLImageElement | HTMLDivElement, imagePath?: string, useSrcset?: boolean) => {\n    if (isImageElement(element) && isChildOfPicture(element)) {\n      setSourcesFn(element);\n    }\n    if (imagePath) {\n      setImage(element, imagePath, useSrcset);\n    }\n  };\n}\n\nexport const setImageAndSourcesToDefault = setImageAndSources(setSourcesToDefault);\nexport const setImageAndSourcesToLazy = setImageAndSources(setSourcesToLazy);\nexport const setImageAndSourcesToError = setImageAndSources(setSourcesToError);\n","import { Observable, Subject } from 'rxjs';\nimport {\n  cssClassNames,\n  hasCssClassName,\n  removeCssClassName,\n  addCssClassName,\n  isImageElement,\n  isChildOfPicture,\n  setSourcesToLazy,\n  setImage,\n  setImageAndSourcesToError,\n  setImageAndSourcesToLazy,\n  setImageAndSourcesToDefault\n} from '../util';\nimport { FinallyFn, LoadImageFn, SetErrorImageFn, SetLoadedImageFn, SetupFn } from '../types';\n\nconst end: FinallyFn = ({ element }) => addCssClassName(element, cssClassNames.loaded);\n\nexport const loadImage: LoadImageFn = ({ element, useSrcset, imagePath }) => {\n  let img: HTMLImageElement;\n  if (isImageElement(element) && isChildOfPicture(element)) {\n    const parentClone = element.parentNode!.cloneNode(true) as HTMLPictureElement;\n    img = parentClone.getElementsByTagName('img')[0];\n    setSourcesToLazy(img);\n    setImage(img, imagePath, useSrcset);\n  } else {\n    img = new Image();\n    if (isImageElement(element) && element.sizes) {\n      img.sizes = element.sizes;\n    }\n    if (useSrcset) {\n      img.srcset = imagePath;\n    } else {\n      img.src = imagePath;\n    }\n  }\n\n  if (img.decode) {\n    return img.decode().then(() => imagePath);\n  }\n\n  return new Promise((resolve, reject) => {\n    img.onload = () => resolve(imagePath);\n    img.onerror = () => reject(null);\n  });\n};\n\nconst setErrorImage: SetErrorImageFn = ({ element, errorImagePath, useSrcset }) => {\n  setImageAndSourcesToError(element, errorImagePath, useSrcset);\n  addCssClassName(element, cssClassNames.failed);\n};\n\nconst setLoadedImage: SetLoadedImageFn = ({ element, imagePath, useSrcset }) => {\n  setImageAndSourcesToLazy(element, imagePath, useSrcset);\n};\n\nconst setup: SetupFn = ({ element, defaultImagePath, useSrcset }) => {\n  setImageAndSourcesToDefault(element, defaultImagePath, useSrcset);\n\n  if (hasCssClassName(element, cssClassNames.loaded)) {\n    removeCssClassName(element, cssClassNames.loaded);\n  }\n};\n\nexport const sharedPreset = {\n  finally: end,\n  loadImage,\n  setErrorImage,\n  setLoadedImage,\n  setup\n};\n","export class Rect {\n  static empty: Rect = new Rect(0, 0, 0, 0);\n\n  left: number;\n  top: number;\n  right: number;\n  bottom: number;\n\n  constructor(left: number, top: number, right: number, bottom: number) {\n    this.left = left;\n    this.top = top;\n    this.right = right;\n    this.bottom = bottom;\n  }\n\n  static fromElement(element: HTMLElement): Rect {\n    const { left, top, right, bottom } = element.getBoundingClientRect();\n\n    if (left === 0 && top === 0 && right === 0 && bottom === 0) {\n      return Rect.empty;\n    } else {\n      return new Rect(left, top, right, bottom);\n    }\n  }\n\n  static fromWindow(_window: Window): Rect {\n    return new Rect(0, 0, _window.innerWidth, _window.innerHeight);\n  }\n\n  inflate(inflateBy: number) {\n    this.left -= inflateBy;\n    this.top -= inflateBy;\n    this.right += inflateBy;\n    this.bottom += inflateBy;\n  }\n\n  intersectsWith(rect: Rect): boolean {\n    return rect.left < this.right && this.left < rect.right && rect.top < this.bottom && this.top < rect.bottom;\n  }\n\n  getIntersectionWith(rect: Rect): Rect {\n    const left = Math.max(this.left, rect.left);\n    const top = Math.max(this.top, rect.top);\n    const right = Math.min(this.right, rect.right);\n    const bottom = Math.min(this.bottom, rect.bottom);\n\n    if (right >= left && bottom >= top) {\n      return new Rect(left, top, right, bottom);\n    } else {\n      return Rect.empty;\n    }\n  }\n}\n","import { empty, Observable, Subject } from 'rxjs';\nimport { sampleTime, share, startWith } from 'rxjs/operators';\nimport { isWindowDefined } from '../util';\n\nconst scrollListeners = new WeakMap<any, Observable<any>>();\n\nexport function sampleObservable<T>(obs: Observable<T>, scheduler?: any): Observable<T | ''> {\n  return obs.pipe(\n    sampleTime(100, scheduler),\n    share(),\n    startWith('')\n  );\n}\n\n// Only create one scroll listener per target and share the observable.\n// Typical, there will only be one observable per application\nexport const getScrollListener = (scrollTarget?: HTMLElement | Window): Observable<Event | ''> => {\n  if (!scrollTarget || typeof scrollTarget.addEventListener !== 'function') {\n    if (isWindowDefined()) {\n      console.warn('`addEventListener` on ' + scrollTarget + ' (scrollTarget) is not a function. Skipping this target');\n    }\n    return empty();\n  }\n  const scrollListener = scrollListeners.get(scrollTarget);\n  if (scrollListener) {\n    return scrollListener;\n  }\n\n  const srollEvent: Observable<Event> = Observable.create((observer: Subject<Event>) => {\n    const eventName = 'scroll';\n    const handler = (event: Event) => observer.next(event);\n    const options = { passive: true, capture: false };\n    scrollTarget.addEventListener(eventName, handler, options);\n    return () => scrollTarget.removeEventListener(eventName, handler, options);\n  });\n\n  const listener = sampleObservable(srollEvent);\n  scrollListeners.set(scrollTarget, listener);\n  return listener;\n};\n","import { startWith } from 'rxjs/operators';\nimport { sharedPreset } from '../shared-preset/preset';\nimport { Attributes, GetObservableFn, HookSet, IsVisibleFn } from '../types';\nimport { isWindowDefined } from '../util';\nimport { Rect } from './rect';\nimport { getScrollListener } from './scroll-listener';\n\nexport const isVisible: IsVisibleFn<Event | string> = ({ element, offset, scrollContainer }, getWindow = () => window) => {\n  const elementBounds = Rect.fromElement(element);\n  if (elementBounds === Rect.empty) {\n    return false;\n  }\n  const windowBounds = Rect.fromWindow(getWindow());\n  elementBounds.inflate(offset);\n\n  if (scrollContainer) {\n    const scrollContainerBounds = Rect.fromElement(scrollContainer);\n    const intersection = scrollContainerBounds.getIntersectionWith(windowBounds);\n    return elementBounds.intersectsWith(intersection);\n  } else {\n    return elementBounds.intersectsWith(windowBounds);\n  }\n};\n\nconst getObservable: GetObservableFn<Event | string> = (attributes: Attributes) => {\n  if (attributes.scrollObservable) {\n    return attributes.scrollObservable.pipe(startWith(''));\n  }\n  if (attributes.scrollContainer) {\n    return getScrollListener(attributes.scrollContainer);\n  }\n  return getScrollListener(isWindowDefined() ? window : undefined);\n};\n\nexport const scrollPreset: HookSet<Event | string> = Object.assign({}, sharedPreset, {\n  isVisible,\n  getObservable\n});\n","import { scrollPreset } from './scroll-preset';\nimport { HookSet, ModuleOptions } from './types';\n\nexport function cretateHooks<E>(options?: ModuleOptions<E>): HookSet<any> {\n  if (!options) {\n    return scrollPreset;\n  }\n  const hooks = {};\n  if (options.preset) {\n    Object.assign(hooks, options.preset);\n  } else {\n    Object.assign(hooks, scrollPreset);\n  }\n  Object.keys(options)\n    .filter(key => key !== 'preset')\n    .forEach(key => {\n      hooks[key] = options[key];\n    });\n  return hooks as HookSet<any>;\n}\n","import { Observable, of } from 'rxjs';\nimport { catchError, filter, map, mergeMap, take, tap } from 'rxjs/operators';\nimport { Attributes, HookSet } from './types';\n\nexport function lazyLoadImage<E>(hookSet: HookSet<E>, attributes: Attributes) {\n  return (scrollObservable: Observable<E>) => {\n    return scrollObservable.pipe(\n      filter(event =>\n        hookSet.isVisible({\n          element: attributes.element,\n          event: event,\n          offset: attributes.offset,\n          scrollContainer: attributes.scrollContainer\n        })\n      ),\n      take(1),\n      mergeMap(() => hookSet.loadImage(attributes)),\n      tap(imagePath =>\n        hookSet.setLoadedImage({\n          element: attributes.element,\n          imagePath,\n          useSrcset: attributes.useSrcset\n        })\n      ),\n      map(() => true),\n      catchError(() => {\n        hookSet.setErrorImage(attributes);\n        return of(false);\n      }),\n      tap(() => hookSet.finally(attributes))\n    );\n  };\n}\n","import { AfterContentInit, Directive, ElementRef, EventEmitter, Inject, Input, NgZone, OnChanges, OnDestroy, Optional, Output, PLATFORM_ID } from '@angular/core';\nimport { isPlatformServer } from '@angular/common';\nimport { ReplaySubject, Observable, Subscription } from 'rxjs';\nimport { switchMap, tap } from 'rxjs/operators';\nimport { cretateHooks } from './hooks-factory';\nimport { lazyLoadImage } from './lazyload-image';\nimport { Attributes, HookSet, ModuleOptions } from './types';\n\n@Directive({\n  selector: '[lazyLoad]'\n})\nexport class LazyLoadImageDirective implements OnChanges, AfterContentInit, OnDestroy {\n  @Input('lazyLoad') lazyImage!: string; // The image to be lazy loaded\n  @Input() defaultImage?: string; // The image to be displayed before lazyImage is loaded\n  @Input() errorImage?: string; // The image to be displayed if lazyImage load fails\n  @Input() scrollTarget?: any; // Scroll container that contains the image and emits scoll events\n  @Input() scrollObservable?: Observable<any>; // Pass your own scroll emitter\n  @Input() offset?: number; // The number of px a image should be loaded before it is in view port\n  @Input() useSrcset?: boolean; // Whether srcset attribute should be used instead of src\n  @Output() onLoad: EventEmitter<boolean> = new EventEmitter(); // Callback when an image is loaded\n  private propertyChanges$: ReplaySubject<Attributes>;\n  private elementRef: ElementRef;\n  private ngZone: NgZone;\n  private scrollSubscription?: Subscription;\n  private hooks: HookSet<any>;\n  private platformId: Object;\n\n  constructor(el: ElementRef, ngZone: NgZone, @Inject(PLATFORM_ID) platformId: Object, @Optional() @Inject('options') options?: ModuleOptions) {\n    this.elementRef = el;\n    this.ngZone = ngZone;\n    this.propertyChanges$ = new ReplaySubject();\n    this.platformId = platformId;\n    this.hooks = cretateHooks(options);\n  }\n\n  ngOnChanges() {\n    this.propertyChanges$.next({\n      element: this.elementRef.nativeElement,\n      imagePath: this.lazyImage,\n      defaultImagePath: this.defaultImage,\n      errorImagePath: this.errorImage,\n      useSrcset: this.useSrcset,\n      offset: this.offset ? this.offset | 0 : 0,\n      scrollContainer: this.scrollTarget,\n      scrollObservable: this.scrollObservable\n    });\n  }\n\n  ngAfterContentInit() {\n    // Disable lazy load image in server side\n    if (isPlatformServer(this.platformId)) {\n      return null;\n    }\n\n    this.ngZone.runOutsideAngular(() => {\n      this.scrollSubscription = this.propertyChanges$\n        .pipe(\n          tap(attributes => this.hooks.setup(attributes)),\n          switchMap(attributes => this.hooks.getObservable(attributes).pipe(lazyLoadImage(this.hooks, attributes)))\n        )\n        .subscribe(success => this.onLoad.emit(success));\n    });\n  }\n\n  ngOnDestroy() {\n    if (this.scrollSubscription) {\n      this.scrollSubscription.unsubscribe();\n    }\n  }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\nimport { LazyLoadImageDirective } from './lazyload-image.directive';\nimport { ModuleOptions } from './types';\n\n@NgModule({\n  declarations: [LazyLoadImageDirective],\n  exports: [LazyLoadImageDirective]\n})\nexport class LazyLoadImageModule {\n  static forRoot(options: ModuleOptions): ModuleWithProviders {\n    return {\n      ngModule: LazyLoadImageModule,\n      providers: [{ provide: 'options', useValue: options }]\n    };\n  }\n}\n","import { empty, Observable, Subject } from 'rxjs';\nimport { filter } from 'rxjs/operators';\nimport { Attributes } from '../types';\nimport { isWindowDefined } from '../util';\n\ntype ObserverOptions = {\n  root?: Element;\n  rootMargin?: string;\n};\n\nconst observers = new WeakMap<Element | {}, IntersectionObserver>();\n\nconst intersectionSubject = new Subject<IntersectionObserverEntry>();\n\nfunction loadingCallback(entrys: IntersectionObserverEntry[]) {\n  entrys.forEach(entry => intersectionSubject.next(entry));\n}\n\nexport const getIntersectionObserver = (attributes: Attributes): Observable<IntersectionObserverEntry> => {\n  if (!attributes.scrollContainer && !isWindowDefined()) {\n    return empty();\n  }\n\n  const options: ObserverOptions = {\n    root: attributes.scrollContainer\n  };\n  if (attributes.offset) {\n    options.rootMargin = `${attributes.offset}px`;\n  }\n\n  const scrollContainer = attributes.scrollContainer || window;\n\n  let observer = observers.get(scrollContainer);\n\n  if (!observer) {\n    observer = new IntersectionObserver(loadingCallback, options);\n    observers.set(scrollContainer, observer);\n  }\n\n  observer.observe(attributes.element);\n\n  return Observable.create((obs: Subject<IntersectionObserverEntry>) => {\n    const subscription = intersectionSubject.pipe(filter(entry => entry.target === attributes.element)).subscribe(obs);\n    return () => {\n      subscription.unsubscribe();\n      observer!.unobserve(attributes.element);\n    };\n  });\n};\n","import { sharedPreset } from '../shared-preset/preset';\nimport { Attributes, GetObservableFn, HookSet, IsVisibleFn } from '../types';\nimport { getIntersectionObserver } from './intersection-listener';\n\nexport const isVisible: IsVisibleFn<IntersectionObserverEntry> = ({ event }) => {\n  return event.isIntersecting;\n};\n\nexport const getObservable: GetObservableFn<IntersectionObserverEntry> = (attributes: Attributes, _getInterObserver = getIntersectionObserver) => {\n  if (attributes.scrollObservable) {\n    return attributes.scrollObservable;\n  }\n  return _getInterObserver(attributes);\n};\n\nexport const intersectionObserverPreset: HookSet<IntersectionObserverEntry> = Object.assign({}, sharedPreset, {\n  isVisible,\n  getObservable\n});\n"],"names":["tslib_1.__decorate","tslib_1.__param","isVisible","getObservable"],"mappings":"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"}